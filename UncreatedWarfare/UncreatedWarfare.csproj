<Project Sdk="Microsoft.NET.Sdk">

  <!-- Set this to false for migrations -->
  <PropertyGroup>
    <CopyToModule>True</CopyToModule>
  </PropertyGroup>

  <PropertyGroup>

    <VersionPrefix>4.0.0</VersionPrefix>
    <VersionBuild>001</VersionBuild>
    <VersionSuffix>prerelease$(VersionBuild)</VersionSuffix>

  </PropertyGroup>

  <PropertyGroup>
    <TargetFramework>netstandard2.1</TargetFramework>
    <AssemblyTitle>Uncreated.Warfare</AssemblyTitle>
    <AssemblyName>Uncreated.Warfare</AssemblyName>
    <Title>Uncreated.Warfare</Title>
    <Product>Uncreated.Warfare</Product>

    <Authors>DanielWillett;benvalkin</Authors>
    <Company>Uncreated</Company>
    <Description>Main framework for the Uncreated Warfare Military Simulation server based off of the military game Squad.</Description>

    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <EnablePreviewFeatures>true</EnablePreviewFeatures>
    <DoNotCopyLocalIfInGac>true</DoNotCopyLocalIfInGac>

    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>

    <PackageLicenseFile>LICENSE.md</PackageLicenseFile>
    <PackageIcon>icon.png</PackageIcon>
    <PackageReadmeFile>README.md</PackageReadmeFile>

    <PackageProjectUrl>https://github.com/UncreatedStaff/UncreatedWarfare</PackageProjectUrl>
    <RepositoryUrl>$(PackageProjectUrl).git</RepositoryUrl>

    <PackageTags>Unturned;Uncreated;Warfare;Uncreated Warfare</PackageTags>
    <NeutralLanguage>en-US</NeutralLanguage>
    <RootNamespace>Uncreated.Warfare</RootNamespace>

    <AssemblyVersion>$(VersionPrefix).$(VersionBuild)</AssemblyVersion>
    <FileVersion>$(VersionPrefix).$(VersionBuild)</FileVersion>

    <BaseIntermediateOutputPath></BaseIntermediateOutputPath>
    <GenerateAssemblyConfigurationAttribute>false</GenerateAssemblyConfigurationAttribute>
    <ProduceReferenceAssembly>False</ProduceReferenceAssembly>
    <GenerateRuntimeConfigurationFiles>True</GenerateRuntimeConfigurationFiles>

    <NoWarn>NU1701;NU1803;NU1903;NU1904;1702,1591,1587,1711,1735,1573,1574,1570,1584,1658</NoWarn>
  </PropertyGroup>

  <PropertyGroup>
    <LangVersion>preview</LangVersion>
    <Nullable>enable</Nullable>
    <GenerateDocumentationFile>True</GenerateDocumentationFile>

    <IncludeSymbols>true</IncludeSymbols>
    <SymbolPackageFormat>snupkg</SymbolPackageFormat>
    <GeneratePackageOnBuild>True</GeneratePackageOnBuild>

    <Title>Uncreated Warfare</Title>
    <IsPublishable>False</IsPublishable>
    <NoWin32Manifest>true</NoWin32Manifest>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugType>portable</DebugType>
    <WarningLevel>5</WarningLevel>
    <DefineConstants>$(DefineConstants)TRACE;UNITY_ASSERTIONS</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugType>portable</DebugType>
    <DefineConstants>$(DefineConstants)TRACE</DefineConstants>
  </PropertyGroup>
  
  <ItemGroup>
    <Compile Remove="Commands\_BlankCommand.cs" />
  </ItemGroup>
  
  <ItemGroup>
    <None Remove="Commands\AbandonCommand.meta.yml" />
    <None Remove="Commands\AmmoCommand.meta.yml" />
    <None Remove="Commands\AttachCommand.meta.yml" />
    <None Remove="Commands\BuyCommand.meta.yml" />
    <None Remove="Commands\DeployCommand.meta.yml" />
    <None Remove="Commands\Kit\KitCommand.meta.yml" />
    <None Remove="Commands\Zone\ZoneCommand.meta.yml" />
  </ItemGroup>

  <ItemGroup>
    <None Include="..\icon.png" Pack="true" PackagePath="\" />
    <None Include="..\README.md" Pack="true" PackagePath="\" />
    <None Include="..\LICENSE.md" Pack="true" PackagePath="\" />
  </ItemGroup>

  <!-- Base U3DS installation -->
  <PropertyGroup>
    <ServerPath>C:\SteamCMD\steamapps\common\U3DS</ServerPath>
  </PropertyGroup>

  <!-- Build to module dir if it exists -->
  <PropertyGroup Condition="'$(CopyToModule)' != 'False' And exists('$(ServerPath)\Modules\Uncreated.Warfare\Bin')">
    <OutDir>$(ServerPath)\Modules\Uncreated.Warfare\Bin</OutDir>
  </PropertyGroup>
  <PropertyGroup Condition="'$(CopyToModule)' == 'False'">
    <TargetFramework>net7.0</TargetFramework>
  </PropertyGroup>

  <!-- Prevent libraries from being copied -->
  <ItemDefinitionGroup Condition="'$(CopyToModule)' != 'False'">
    <PackageReference ExcludeAssets="runtime" />
  </ItemDefinitionGroup>

  <ItemDefinitionGroup Condition="'$(CopyToModule)' != 'False'">
    <Reference Private="false" />
  </ItemDefinitionGroup>

  <ItemGroup>
    <None Include="Commands\_BlankCommand.cs" />
  </ItemGroup>


  <ItemGroup>
    <None Include="..\.editorconfig" Link=".editorconfig" />
  </ItemGroup>

  <!-- ReSharper disable VulnerablePackage (using older versions of EF and STJ) -->
  <ItemGroup>
    <PackageReference Include="DanielWillett.StackCleaner" Version="[1.4.2,)" />
    <PackageReference Include="DanielWillett.ReflectionTools" Version="[4.0.0,)" />
    <PackageReference Include="DanielWillett.ReflectionTools.Harmony" Version="[4.0.0,)" />
    <PackageReference Include="DanielWillett.SpeedBytes" Version="[1.1.2,)" />
    <PackageReference Include="DanielWillett.SpeedBytes.Unity" Version="[1.1.1,)" />
    <PackageReference Include="DanielWillett.JavaPropertiesParser" Version="[1.0.0,)" />
    <PackageReference Include="DanielWillett.ModularRPCs" Version="[1.0.0-prerelease02, 2)" />
    <PackageReference Include="DanielWillett.ModularRPCs.Unity" Version="[1.0.0-prerelease02, 2)" />
    <PackageReference Include="DanielWillett.ModularRPCs.WebSockets" Version="[1.0.0-prerelease02, 2)" />
    <PackageReference Include="Uncreated.UI" Version="[1.0.0,)" />
    <PackageReference Include="Stripe.net" Version="[43.4.0,)" />
    <PackageReference Include="JetBrains.Annotations" Version="[2018.2.1,)" Aliases="JetBrains" />

    <PackageReference Include="UniTask" Version="2.5.0" IncludeAssets="none" />

    <PackageReference Include="Autofac" Version="7.1.0" />
    <PackageReference Include="Autofac.Extensions.DependencyInjection" Version="7.2.0" />

    <!-- for the love of god do not touch these version numbers -->

    <PackageReference Include="System.Data.Common" Version="4.3.0" />
    <PackageReference Include="System.Runtime.Caching" Version="4.5.0" />
    <PackageReference Include="System.Text.Json" Version="4.7.1" NoWarn="NU1605" />

    <PackageReference Include="Microsoft.Extensions.Configuration.Abstractions" Version="3.1.3" />
    <PackageReference Include="Microsoft.Extensions.Configuration" Version="3.1.3" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="3.1.3" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="3.1.3" />
    <PackageReference Include="NetEscapades.Configuration.Yaml" Version="3.1.0" />

    <PackageReference Include="MySqlConnector" Version="0.69.10" />
    <PackageReference Include="Microsoft.Bcl.HashCode" Version="1.1.1" />
    <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="3.1.0" />
    <PackageReference Include="Microsoft.EntityFrameworkCore" Version="3.1.0" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Relational" Version="3.1.0" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.0" Private="true" />
    <PackageReference Include="Pomelo.EntityFrameworkCore.MySql" Version="3.1.2" />

    <PackageReference Update="OpenMod.UnityEngine.Redist" ExcludedAssets="all"  />
    <PackageReference Update="OpenMod.Unturned.Redist" ExcludedAssets="all"  />
    <!--<PackageReference Remove="System.ComponentModel.Annotations" />-->
  </ItemGroup>

  <ItemGroup Condition="'$(CopyToModule)' == 'False'">
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="6.0.0">
      <Aliases>DepInj</Aliases>
    </PackageReference>
  </ItemGroup>
  <!-- ReSharper restore VulnerablePackage -->

  <!-- Embedded Files -->
  <ItemGroup>

    <EmbeddedResource Include="$(SolutionDir)Translation README.md" />

    <EmbeddedResource Include="Commands\DeployCommand.meta.yml" />

    <EmbeddedResource Include="Commands\BuyCommand.meta.yml" />

    <EmbeddedResource Include="Commands\AttachCommand.meta.yml" />

    <EmbeddedResource Include="Commands\AmmoCommand.meta.yml" />

    <!-- Commands -->
    <EmbeddedResource Include="Commands\Clear\ClearCommand.meta.yml" />
    <EmbeddedResource Include="Commands\AbandonCommand.meta.yml" />
    <EmbeddedResource Include="Commands\Kit\KitCommand.meta.yml" />
    <EmbeddedResource Include="Commands\Zone\ZoneCommand.meta.yml" />

  </ItemGroup>

  <!-- Global Usings (JetBrains annotations imports are in Properties/JetBrains.Annotations.cs) -->
  <ItemGroup>
    <Using Remove="System.Net.Http" />
    <Using Remove="System.Text" />
    <Using Include="JetBrains.Annotations" />
    <Using Include="SDG.Unturned" />
    <Using Include="Autofac" />
    <Using Include="Steamworks" />
    <Using Include="System.Collections" />
    <Using Include="UnityEngine" />
    <Using Include="Steamworks" />
    <Using Include="System.Threading" />
    <Using Include="System.Threading.Tasks" />
    <Using Include="Cysharp.Threading.Tasks" />
    <Using Include="UnityEngine.Object">
      <Alias>Object</Alias>
    </Using>
    <Using Include="System.Diagnostics.Contracts" />
    <Using Include="System.Diagnostics.Contracts.PureAttribute">
      <Alias>PureAttribute</Alias>
    </Using>
    <Using Include="System.Version">
      <Alias>Version</Alias>
    </Using>
    <Using Include="System.Action">
      <Alias>Action</Alias>
    </Using>
    <Using Include="Microsoft.Extensions.Logging" />
    <Using Include="Microsoft.Extensions.Logging.ILogger">
      <Alias>ILogger</Alias>
    </Using>
  </ItemGroup>

  <!-- Installation -->
  <PropertyGroup>
    <U3DSPath>C:/SteamCMD/steamapps/common/U3DS</U3DSPath>
  </PropertyGroup>

  <!-- Unturned Files -->
  <Choose>
    <When Condition="exists('$(U3DSPath)/Unturned_Data/Managed/Assembly-CSharp.dll')">
      <PropertyGroup>
        <UnturnedDllPath>$(U3DSPath)/Unturned_Data/Managed</UnturnedDllPath>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <UnturnedDllPath>../Libraries</UnturnedDllPath>
      </PropertyGroup>
    </Otherwise>
  </Choose>

  <ItemGroup>
    <!-- Unturned -->
    <Reference Include="Assembly-CSharp">
      <HintPath>$(UnturnedDllPath)/Assembly-CSharp.dll</HintPath>

      <!-- Prevents copying to output dir -->
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="SDG.NetTransport">
      <HintPath>$(UnturnedDllPath)/SDG.NetTransport.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="SDG.NetPak.Runtime">
      <HintPath>$(UnturnedDllPath)/SDG.NetPak.Runtime.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnturnedDat">
      <HintPath>$(UnturnedDllPath)/UnturnedDat.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEx">
      <HintPath>$(UnturnedDllPath)/UnityEx.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>

    <!-- Third Party -->
    <Reference Include="com.rlabrecque.steamworks.net">
      <HintPath>$(UnturnedDllPath)/com.rlabrecque.steamworks.net.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UniTask">
      <HintPath>../Libraries/UniTask.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>

    <!-- Unity -->
    <Reference Include="UnityEngine">
      <HintPath>$(UnturnedDllPath)/UnityEngine.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEngine.CoreModule">
      <HintPath>$(UnturnedDllPath)/UnityEngine.CoreModule.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEngine.PhysicsModule">
      <HintPath>$(UnturnedDllPath)/UnityEngine.PhysicsModule.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEngine.ImageConversionModule">
      <HintPath>$(UnturnedDllPath)/UnityEngine.ImageConversionModule.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEngine.UnityWebRequestModule">
      <HintPath>$(UnturnedDllPath)/UnityEngine.UnityWebRequestModule.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
    <Reference Include="UnityEngine.AssetBundleModule">
      <HintPath>$(UnturnedDllPath)/UnityEngine.AssetBundleModule.dll</HintPath>
      <Private>!$(CopyToModule)</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup>
    <Folder Include="Commands\VehicleBay\" />
  </ItemGroup>

  <Target Name="PreBuild" BeforeTargets="PreBuildEvent" Condition="exists('$(U3DSPath)/Unturned_Data/Managed/Assembly-CSharp.dll')">
    <Exec Command="XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),Assembly-CSharp.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,Assembly-CSharp.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnturnedDat.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnturnedDat.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEx.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEx.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),SDG.NetTransport.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,SDG.NetTransport.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),SDG.NetPak.Runtime.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,SDG.NetPak.Runtime.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),com.rlabrecque.steamworks.net.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,com.rlabrecque.steamworks.net.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.CoreModule.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.CoreModule.dll))*&quot;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.ImageConversionModule.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.ImageConversionModule.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.PhysicsModule.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.PhysicsModule.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.UnityWebRequestModule.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.UnityWebRequestModule.dll))*&quot;&#xD;&#xA;XCOPY /v /y &quot;$([System.IO.Path]::Combine($(UnturnedDllPath),UnityEngine.AssetBundleModule.dll))*&quot; &quot;$([System.IO.Path]::Combine(../Libraries,UnityEngine.AssetBundleModule.dll))*&quot;" />
  </Target>
</Project>